CREATE DATABASE bookstore;
\c bookstore;

CREATE SEQUENCE user_sequence INCREMENT by 1;

CREATE TABLE users
(
    id            BIGINT    DEFAULT nextval('user_sequence') PRIMARY KEY,
    username      VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    last_login    TIMESTAMP,
    is_admin      BOOLEAN   DEFAULT FALSE,
    created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- username: admin; password: password
INSERT INTO users (username, password_hash, is_admin)
VALUES ('admin', '$2a$10$p8jxVtmibgMSFWw9/EIQVeXr0pg0ss57mIBbicJnezdTQLdYsRADe', true);

CREATE SEQUENCE book_sequence INCREMENT by 1;

CREATE TABLE books
(
    id           BIGINT    DEFAULT nextval('book_sequence') PRIMARY KEY,
    title        varchar(255) NOT NULL UNIQUE,
    author       varchar(255) NOT NULL,
    price        NUMERIC(10, 2),
    release_year varchar(255) NOT NULL,
    created_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE FUNCTION random_timestamp(from_ts timestamp, to_ts timestamp) RETURNS TIMESTAMP AS
$$
BEGIN
    RETURN from_ts + (RANDOM() * (to_ts - from_ts));
END;
$$ LANGUAGE plpgsql;


CREATE SEQUENCE books_seq START 1;

INSERT INTO books (title, author, release_year, price, created_at, updated_at)
VALUES ('The Road to Wigan Pier', 'George Orwell', '1937', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Hobbit', 'J.R.R. Tolkien', '1937', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Brothers Karamazov', 'Fyodor Dostoevsky', '1880', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Metamorphosis', 'Franz Kafka', '1915', 10.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Secret Garden', 'Frances Hodgson Burnett', '1911', 11.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Adventures of Sherlock Holmes', 'Arthur Conan Doyle', '1892', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Road Not Taken', 'Robert Frost', '1916', 9.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Les Misérables', 'Victor Hugo', '1862', 17.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Old Man and the Sea', 'Ernest Hemingway', '1952', 14.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Little Prince', 'Antoine de Saint-Exupéry', '1943', 12.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Wind in the Willows', 'Kenneth Grahame', '1908', 11.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Sun Also Rises', 'Ernest Hemingway', '1926', 13.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Bell Jar', 'Sylvia Plath', '1963', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Crime and Punishment', 'Fyodor Dostoevsky', '1866', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Girl on the Train', 'Paula Hawkins', '2015', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Stranger', 'Albert Camus', '1942', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Road Less Traveled', 'M. Scott Peck', '1978', 16.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Color Purple', 'Alice Walker', '1982', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Adventures of Huckleberry Finn', 'Mark Twain', '1884', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Nightingale', 'Kristin Hannah', '2015', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Help', 'Kathryn Stockett', '2009', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Book Thief', 'Markus Zusak', '2005', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Great Alone', 'Kristin Hannah', '2018', 16.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Reckoning', 'John Grisham', '2018', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Alice Network', 'Kate Quinn', '2017', 16.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Night Circus', 'Erin Morgenstern', '2011', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Dutch House', 'Ann Patchett', '2019', 16.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Silent Patient', 'Alex Michaelides', '2019', 16.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Giver', 'Lois Lowry', '1993', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Hunger Games', 'Suzanne Collins', '2008', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Maze Runner', 'James Dashner', '2009', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Fault in Our Stars', 'John Green', '2012', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Perks of Being a Wallflower', 'Stephen Chbosky', '1999', 14.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Martian', 'Andy Weir', '2011', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Revenant', 'Michael Punke', '2002', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('To Kill a Mockingbird', 'Harper Lee', '1960', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Pride and Prejudice', 'Jane Austen', '1813', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('1984', 'George Orwell', '1949', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Brave New World', 'Aldous Huxley', '1932', 13.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Catcher in the Rye', 'J.D. Salinger', '1951', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Moby-Dick', 'Herman Melville', '1851', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('War and Peace', 'Leo Tolstoy', '1869', 16.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Great Gatsby', 'F. Scott Fitzgerald', '1925', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Lord of the Rings', 'J.R.R. Tolkien', '1954', 18.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Anna Karenina', 'Leo Tolstoy', '1877', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Frankenstein', 'Mary Shelley', '1818', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Picture of Dorian Gray', 'Oscar Wilde', '1890', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Alice''s Adventures in Wonderland', 'Lewis Carroll', '1865', 11.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Wuthering Heights', 'Emily Brontë', '1847', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Count of Monte Cristo', 'Alexandre Dumas', '1844', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Scarlet Letter', 'Nathaniel Hawthorne', '1850', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('One Hundred Years of Solitude', 'Gabriel García Márquez', '1967', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Shining', 'Stephen King', '1977', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Lord of the Flies', 'William Golding', '1954', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Road', 'Cormac McCarthy', '2006', 15.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('A Tale of Two Cities', 'Charles Dickens', '1859', 12.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Alchemist', 'Paulo Coelho', '1988', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Grapes of Wrath', 'John Steinbeck', '1939', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Da Vinci Code', 'Dan Brown', '2003', 14.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Outsiders', 'S.E. Hinton', '1967', 11.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Kite Runner', 'Khaled Hosseini', '2003', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Handmaid''s Tale', 'Margaret Atwood', '1985', 13.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('Siddhartha', 'Hermann Hesse', '1922', 12.49,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Chronicles of Narnia', 'C.S. Lewis', '1950', 15.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01')),
       ('The Stand', 'Stephen King', '1978', 16.99,
        random_timestamp('2023-01-01', '2023-01-30'),
        random_timestamp('2023-02-01', '2023-09-01'));
